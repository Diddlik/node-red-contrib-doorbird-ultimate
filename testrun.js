var argon2 = require('argon2');
var chacha = require('chacha-js');

// example from DoorBird API Doc
var buf = Buffer.from([
    0xDE, 0xAD, 0xBE, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x20, 0x00, 0x77, 0x35, 0x36, 0xDC, 0xC3,
    0x0E, 0x2E, 0x84, 0x7E, 0x0E, 0x75, 0x29, 0xE2, 0x34, 0x60, 0xCF, 0xE3, 0xFF, 0xCC, 0x52, 0x3F, 0x37,
    0xB2, 0xF2, 0xDC, 0x1A, 0x71, 0x80, 0xF2, 0x9B, 0x2E, 0xA0, 0x27, 0xA9, 0x82, 0x41, 0x9C, 0xCE, 0x45,
    0x9D, 0x27, 0x45, 0x2E, 0x42, 0x14, 0xBE, 0x9C, 0x74, 0xE9, 0x33, 0x3A, 0x21, 0xDB, 0x10, 0x78, 0xB9,
    0xF6, 0x7B]);

// 0xDE, 0xD, 0xBE
var identifier = buf.slice(0, 3);
// 0x01
var version = buf.slice(3, 4);

// 4
var opslimit = buf.slice(4, 8);
console.log(opslimit);

// 8192
var memlimit = buf.slice(8, 12);
console.log(memlimit);

var salt = buf.slice(12, 28);
console.log(salt);

var options = {
    type: argon2.argon2i,
    memoryCost: 8192,
    timeCost: 4,
    raw: true,
    salt: salt,
    hashLength: 32
};

var username = "foobar0001";
var password = "QzT3jeK3JY";

console.log(password.substring(0, 5));

argon2.hash(password.substring(0, 5), options).then(hash => {
    // EXPECTED: 0x47 0xB8 0xA5 0xBC 0xDD 0xDA 0x29 0xEB 0x4C 0x0F 0xF6 0x78 0x46 0x41 0xE7 0x2F 0x7B 0x9C 0x45 0xD5 0x46 0x1A 0x60 0x71 0x2C 0x68 0x1F 0x05 0x23 0x9B 0xCC 0xA2
    // ACTUAL:   0x6B 0x1D 0x7A 0x44 0x16 0x63 0x3C 0xFE 0xE7 0xDD 0xB1 0x66 0x02 0x98 0x80 0xC1 0x77 0x6c 0x78 0x8E 0x9B 0x03 0x9F 0x25 0x76 0x9D 0x3D 0xCD 0x10 0x08 0x7B 0x42
    console.log(hash);

    // continue with decryption
});
